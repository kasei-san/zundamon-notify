# issue-and-fix スキル手順書

問題報告から修正PRまでの一連のフローを実行する。
コンテキストが切れても issue を見ればフルコンテキストが残るようにする。

## 前提

- `$ARGUMENTS` に問題の説明が渡される
- グローバル CLAUDE.md のルール（コミットメッセージ、PR作成、報告フロー等）に従うこと

## Step 1: GitHub issue を作成する

- `$ARGUMENTS` から問題の説明を取得する
- `gh issue create` で issue を作成する
  - タイトル: 問題の要約（簡潔に）
  - 本文: 問題の詳細説明（`$ARGUMENTS` の内容をそのまま or 整理して記載）
  - `--assignee @me` でアサイン
- 作成された issue 番号を記録する（以降のステップで使用）

## Step 2: 問題を調査・plan する

- `EnterPlanMode` を使って問題の調査と解決策の設計を行う
- コードベースを探索し、原因を特定する
- 修正方針を plan としてまとめる
- plan が承認されたら次のステップへ進む

## Step 3: plan の内容を issue にコメントとして追記する

- `gh issue comment <issue番号>` で、plan の内容（調査結果 + 実装方針）をコメントする
- フォーマット:
  ```
  # 実装計画

  ## 調査結果
  （原因や影響範囲の説明）

  ## 実装方針
  （修正内容のステップバイステップ説明）
  ```
- h1見出しルール: コメントの1行目は `# 実装計画` とする（グローバル CLAUDE.md のPR・issueコメントルールに従う）
- コンテキストが切れてもこの issue を見れば何をすべきか分かるレベルの詳細さで書く

## Step 4: ブランチを切って修正する

- main を最新にしてからブランチを切る:
  ```bash
  git checkout main && git pull origin main
  git checkout -b issue-<番号>-<短い説明>
  ```
- plan に従ってコードを修正する
- プロジェクト CLAUDE.md の開発ルール（ドキュメント更新含む）に従う
- コミットメッセージはグローバル CLAUDE.md のルールに従う（先頭にブランチ名）

## Step 5: PR を作成して issue とリンクする

**重要: 修正が完了したら、ユーザーに確認を取らずに即座にPRを作成すること。**

- `gh pr create` で PR を作成する
  - PR名の先頭にブランチ名をつける
  - PR 本文に `Closes #<issue番号>` を含めて自動リンク
  - `--assignee @me` でアサイン
- `open` コマンドで PR をブラウザで開く

## Step 6: issue に完了コメントを追加する

- issue に対して、PR のリンクと作業内容のサマリーをコメントとして追加する
- フォーマット:
  ```
  # 修正完了

  PR: <PRのURL>

  ## 作業内容
  （変更内容のサマリー）
  ```
- `open` コマンドで issue をブラウザで開く

## Step 7: ユーザーに報告する

グローバル CLAUDE.md の「作業完了時の報告フロー」に従って報告する:
- **やったこと**: 作業内容の要約
- **PRリンク**: 作成したPRのURL
- **結果**: 作業の結果
- **Next Actions**: 次にやるべきこと（レビュー依頼等）
